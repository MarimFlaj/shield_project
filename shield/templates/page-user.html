{% extends "layouts/base.html" %}
{% load i18n %}
{% load static %}
{% block title %} Urls {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}
<!-- Button trigger modal -->

<div class="content-body">
	<div class="container-fluid" style="text-align: right;">
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
            {% trans 'Edit' %}
        </button>
        
          <!-- Modal -->
        <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Edit Profile</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="EditProfile" method="post">
                    {% csrf_token %}
                   
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'First name' %}</label>
                        <div class="col-sm-8">
                            <input type="text" name="f_name" id="id_f_name" class="form-control" value="{{ request.user.f_name }}">
                        </div>
                    </div>
                     <!-- <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'Middle name' %}</label>
                        <div class="col-sm-8">
                            <input type="text" name="m_name" id="id_m_name" class="form-control" value="{{ request.user.m_name }}">
                        </div> 
                    </div>-->
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'Last name' %}</label>
                        <div class="col-sm-8">
                            <input type="text" name="l_name" id="id_l_name" class="form-control" value="{{ request.user.l_name }}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'Username' %}</label>
                        <div class="col-sm-8">
                            <input type="text" name="username" id="id_username" class="form-control" value="{{ request.user.username }}">
                        </div>
                    </div>
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'email' %}</label>
                        <div class="col-sm-8">
                            <input type="text" name="email" id="id_email" class="form-control" value="{{ request.user.email }}" >
                        </div>
                    </div>
                    
                    <div class="mb-3 row">
                        <label class="col-sm-3 col-form-label">{% trans 'Gender' %}</label>
                        <div class="col-sm-8">
                            <div  style=" text-align:center !important;width: 100%;">
                                <select class="" name="gander" style="
                                {% comment %} width: 50%; {% endcomment %}
                                border-radius: 9px;
                                height: 40px;
                                width:100%;
                                border-right: 0px;
                                border: 0px;
                                {% comment %} text-align:center !important; {% endcomment %}
                                color: gray;
                                margin: 8px 0;
                                padding: 10px 15px;
                                background-color:#eee;
                            ">
                                    <option selected>Choose gander...</option>
                                    <option value="male">male</option>
                                    <option value="female">female</option>
                                </select>
                        </div>
                    </div>
                    
                    
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal" id="modalClose">Close</button>
                <button type="button" id="EditProfileBtn" class="btn btn-primary">{% trans 'Save' %}</button>

            </div>
            </div>
        </div>
        </div>
					
		</div>

        <div class="row"> 
            <div class="col-12">
                <div class="card">
                    
                        <div class="filter cm-content-box box-primary border">
                            <div class="cm-content-body form excerpt border-top" >
                                <div class="card-body ItemsCheckboxSec p-sm-4">
                                    
                                    <div id="SaveNew" style ="text-align:center" readonly>
                                        
                                        <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'First name' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.f_name }}">
                                            </div>
                                        </div>
                                         <!-- <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'Middle name' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.m_name }}">
                                            </div>
                                        </div> -->
                                        <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'Last name' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.l_name }}">
                                            </div>
                                        </div>
                                        <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'Username' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.username }}">
                                            </div>
                                        </div>
                                        <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'email' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.email }}" >
                                            </div>
                                        </div>
                                        <div class="mb-3 row">
                                            <label class="col-sm-3 col-form-label">{% trans 'Gender' %}</label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" readonly value="{{ request.user.gander }}">
                                            </div>
                                        </div>
                                        
                                        
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

	</div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script src="{% static 'assets/js/sweetalert2.all.min.js' %}"></script>

<script>
    function alert_message(msg="",icon="success",timer=3000){
        Swal.fire({
            position:'center',
            showConfirmButton:false,
            icon:icon,
            title:msg,
            timer: timer,
        })
      }
    
    $(document).ready(function () {

        $(document).on("click", "#EditProfileBtn", function () {
            var formData = new FormData($("#EditProfile")[0]);
            formData.append('update', true);
            var form = $("#EditProfile")
            $.ajax({
                method: "post",
                contentType: false,
                processData: false,
                data: formData,
                beforeSend: function (xhr) {
                    xhr.setRequestHeader(
                    "X-CSRFToken",
                    $("input[name=csrfmiddlewaretoken]").val()
                    );
                },
            
                success: function (data) {
                    if (data.status == "1") {
                        alert_message(data.msg);
                        
                        form.find('.error').text('').hide();
                        
                        form.find('.error-message').remove();
                        $("#modalClose").trigger('click');
                        
                        
                    } 
                    
                    else if (data.status == "2") {
                    alert_message(data.msg, "error");
                    } 
                    else {
                        form.find('.error').text('').hide();
            
                        // Display form errors under each field dynamically
                        form.find('.error-message').remove();  // Remove existing error messages
                        $.each(data.errors, function (field, error) {
                        
                        var fieldName= $('[name="' + field + '"]');
                        var errorMessage = $('<div class="error-message" style="color: green;font-size:8px !important"
                        fieldName.after(errorMessage);
                        fieldName.focus();
                        });
                    
                    }
                },
                error: function (xhr, status, error) {
                    console.error(error);
                },
            });
        });

    });
    
</script>

{% endblock javascripts %}
